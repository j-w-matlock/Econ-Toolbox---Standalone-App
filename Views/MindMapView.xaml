<UserControl x:Class="EconToolbox.Desktop.Views.MindMapView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:EconToolbox.Desktop.ViewModels"
             Background="{StaticResource Brush.SurfaceAlt}"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True">
    <UserControl.Resources>
        <HierarchicalDataTemplate DataType="{x:Type vm:MindMapNodeViewModel}" ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                <Ellipse Width="8"
                         Height="8"
                         Fill="{StaticResource Brush.Accent}"
                         Margin="0,0,6,0"/>
                <TextBlock Text="{Binding Title}"/>
            </StackPanel>
        </HierarchicalDataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Background="#EEF6FF"
                BorderBrush="#AACDF1"
                BorderThickness="1"
                CornerRadius="10"
                Padding="14"
                Margin="0,0,0,12">
            <StackPanel>
                <TextBlock Text="Mind Map Planner"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="#1F6AB0"/>
                <TextBlock TextWrapping="Wrap"
                           Margin="0,6,0,0">
                    Use the mind map to capture a central theme, break it into connected ideas, and note the actions
                    needed to move forward. Create root nodes for major pillars, child nodes for deeper details, and keep
                    explanatory notes on the right.
                </TextBlock>
            </StackPanel>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="4*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0"
                    Background="White"
                    CornerRadius="8"
                    Padding="12"
                    Margin="0,0,12,0"
                    BorderBrush="#E2E8F0"
                    BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Structure"
                               FontWeight="Bold"
                               FontSize="16"/>

                    <WrapPanel Grid.Row="1"
                               Margin="0,8,0,8"
                               ItemHeight="36"
                               ItemWidth="140">
                        <Button Command="{Binding AddRootNodeCommand}"
                                Margin="0,0,8,8"
                                MinWidth="120"
                                ToolTip="Create a new top-level pillar">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="+"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Margin="0,0,6,0"/>
                                <TextBlock Text="Add Root"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding AddChildNodeCommand}"
                                Margin="0,0,8,8"
                                MinWidth="120"
                                ToolTip="Add a child idea under the selected node">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="↳"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Margin="0,0,6,0"/>
                                <TextBlock Text="Add Child"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding AddSiblingNodeCommand}"
                                Margin="0,0,8,8"
                                MinWidth="120"
                                ToolTip="Create another idea at the same level as the selected node">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="⇢"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Margin="0,0,6,0"/>
                                <TextBlock Text="Add Sibling"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding RemoveNodeCommand}"
                                Margin="0,0,8,8"
                                MinWidth="120"
                                ToolTip="Remove the selected idea and its descendants">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="×"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Margin="0,0,6,0"/>
                                <TextBlock Text="Remove"/>
                            </StackPanel>
                        </Button>
                    </WrapPanel>

                    <ScrollViewer Grid.Row="2"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <TreeView ItemsSource="{Binding Nodes}">
                            <TreeView.ItemContainerStyle>
                                <Style TargetType="TreeViewItem">
                                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                                    <Setter Property="Margin" Value="0,2,0,2"/>
                                </Style>
                            </TreeView.ItemContainerStyle>
                        </TreeView>
                    </ScrollViewer>
                </Grid>
            </Border>

            <Border Grid.Column="1"
                    Background="White"
                    CornerRadius="8"
                    Padding="16"
                    BorderBrush="#E2E8F0"
                    BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="{Binding SelectedPath}"
                               FontSize="16"
                               FontWeight="Bold"
                               Margin="0,0,0,12">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedNode}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <TextBlock Grid.Row="1"
                               Text="Select an idea on the left to add notes, context, and next steps."
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               Foreground="#5F6B7C"
                               FontSize="14"
                               TextWrapping="Wrap"
                               TextAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedNode}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <ContentControl Grid.Row="1"
                                    Content="{Binding SelectedNode}">
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <Trigger Property="Content" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                        <ContentControl.ContentTemplate>
                            <DataTemplate DataType="{x:Type vm:MindMapNodeViewModel}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Margin="0,0,0,12">
                                        <TextBlock Text="Idea Title" FontWeight="SemiBold"/>
                                        <TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,6,0,0"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="1" Margin="0,0,0,12">
                                        <TextBlock Text="Key Points / Notes" FontWeight="SemiBold"/>
                                        <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                                 Margin="0,6,0,0"
                                                 AcceptsReturn="True"
                                                 TextWrapping="Wrap"
                                                 Height="160"
                                                 VerticalScrollBarVisibility="Auto"/>
                                    </StackPanel>

                                    <Border Grid.Row="2"
                                            Background="#F8FAFC"
                                            BorderBrush="#E2E8F0"
                                            BorderThickness="1"
                                            CornerRadius="6"
                                            Padding="12">
                                        <StackPanel>
                                            <TextBlock Text="Child ideas" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                            <ItemsControl ItemsSource="{Binding Children}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                                                            <TextBlock Text="•"
                                                                       FontSize="16"
                                                                       Margin="0,0,6,0"
                                                                       Foreground="#2D6A8E"/>
                                                            <TextBlock Text="{Binding Title}"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                                <ItemsControl.Style>
                                                    <Style TargetType="ItemsControl">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Children.Count}" Value="0">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ItemsControl.Style>
                                            </ItemsControl>
                                            <TextBlock Text="No child ideas yet. Use “Add Child” to break this topic down further."
                                                       Foreground="#5F6B7C"
                                                       TextWrapping="Wrap">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Children.Count}" Value="0">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
