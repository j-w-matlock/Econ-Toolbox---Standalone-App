<UserControl x:Class="EconToolbox.Desktop.Views.EadView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="clr-namespace:EconToolbox.Desktop.Behaviors"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True">
    <Grid>
        <ScrollViewer Focusable="False"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      Padding="{StaticResource Padding.Card}">
            <StackPanel>
                <TextBlock Text="Expected Annual Damage"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource Brush.Primary}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,12"/>

                <Border Background="{StaticResource Brush.Surface}"
                        CornerRadius="8"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        Padding="{StaticResource Padding.Content}"
                        Margin="0,0,0,12">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Command="{Binding AddDamageColumnCommand}"
                                Padding="12,6"
                                Margin="0,0,12,0"
                                ToolTip="Append a new damage column for an additional category or scenario.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                <TextBlock Text="Add Damage Column"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding RemoveDamageColumnCommand}"
                                Padding="12,6"
                                Margin="0,0,12,0"
                                ToolTip="Remove the most recently added damage column.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                <TextBlock Text="Remove Damage Column"/>
                            </StackPanel>
                        </Button>
                        <CheckBox IsChecked="{Binding UseStage}"
                                  VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                ToolTip="Toggle to add a stage column so you can enter paired stage values."/>
                                <TextBlock Text="Include Stage" Margin="4,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </CheckBox>
                    </StackPanel>
                </Border>

                <Border Background="{StaticResource Brush.Surface}"
                        CornerRadius="10"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        Padding="{StaticResource Padding.Content}"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock Text="Stage / Frequency / Damage Inputs"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding Rows}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="True"
                                  CanUserDeleteRows="True"
                                  HeadersVisibility="Column"
                                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                  Margin="0"
                                  behaviors:DataGridColumnsBehavior.ColumnsSource="{Binding ColumnDefinitions}"/>
                    </StackPanel>
                </Border>

                <Border Background="{StaticResource Brush.Surface}"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="{StaticResource Padding.Content}"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBox Text="{Binding ChartTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="16"
                                 FontWeight="SemiBold"
                                 HorizontalAlignment="Center"
                                 Margin="0,0,0,12"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 TextAlignment="Center"
                                 HorizontalContentAlignment="Center"/>
                        <Viewbox Stretch="Uniform" StretchDirection="Both">
                            <Grid Width="640"
                                  Height="320"
                                  SnapsToDevicePixels="True">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="24"/>
                                    <RowDefinition Height="186.67"/>
                                    <RowDefinition Height="44"/>
                                    <RowDefinition Height="32"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="110"/>
                                    <ColumnDefinition Width="480"/>
                                    <ColumnDefinition Width="20"/>
                                </Grid.ColumnDefinitions>

                                <Grid Grid.Row="1" Grid.Column="0" Margin="0,0,14,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="34"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding EditableYAxisTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Grid.Column="0"
                                             FontWeight="SemiBold"
                                             FontSize="{Binding AxisTitleFontSize}"
                                             Foreground="{StaticResource Brush.TextPrimary}"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             TextAlignment="Center">
                                        <TextBox.RenderTransform>
                                            <TransformGroup>
                                                <RotateTransform Angle="-90" CenterX="0" CenterY="0"/>
                                                <TranslateTransform X="{Binding YAxisTitleOffsetX}" Y="{Binding YAxisTitleOffsetY}"/>
                                            </TransformGroup>
                                        </TextBox.RenderTransform>
                                    </TextBox>
                                    <Grid Grid.Column="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="{Binding YAxisMaxLabel}"
                                                   Grid.Row="0"
                                                   VerticalAlignment="Top"
                                                   HorizontalAlignment="Right"
                                                   FontSize="{Binding AxisLabelFontSize}"
                                                   Foreground="{StaticResource Brush.TextSecondary}">
                                            <TextBlock.RenderTransform>
                                                <TranslateTransform X="{Binding AxisLabelOffsetX}" Y="{Binding AxisLabelOffsetY}"/>
                                            </TextBlock.RenderTransform>
                                        </TextBlock>
                                        <TextBlock Text="{Binding YAxisMidLabel}"
                                                   Grid.Row="1"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Right"
                                                   FontSize="{Binding AxisLabelFontSize}"
                                                   Foreground="{StaticResource Brush.TextSecondary}">
                                            <TextBlock.RenderTransform>
                                                <TranslateTransform X="{Binding AxisLabelOffsetX}" Y="{Binding AxisLabelOffsetY}"/>
                                            </TextBlock.RenderTransform>
                                        </TextBlock>
                                        <TextBlock Text="{Binding YAxisMinLabel}"
                                                   Grid.Row="2"
                                                   VerticalAlignment="Bottom"
                                                   HorizontalAlignment="Right"
                                                   FontSize="{Binding AxisLabelFontSize}"
                                                   Foreground="{StaticResource Brush.TextSecondary}">
                                            <TextBlock.RenderTransform>
                                                <TranslateTransform X="{Binding AxisLabelOffsetX}" Y="{Binding AxisLabelOffsetY}"/>
                                            </TextBlock.RenderTransform>
                                        </TextBlock>
                                    </Grid>
                                </Grid>

                                <Border Grid.Row="1"
                                        Grid.Column="1"
                                        Background="{StaticResource Brush.ChartFill}"
                                        CornerRadius="8"
                                        BorderBrush="{StaticResource Brush.Border}"
                                        BorderThickness="1">
                                    <Grid Width="480"
                                          Height="186.67"
                                          SnapsToDevicePixels="True"
                                          ClipToBounds="True">
                                        <Grid>
                                            <Grid x:Name="ChartContentGrid">
                                                <Grid.RenderTransform>
                                                    <MatrixTransform x:Name="ChartTransform"/>
                                                </Grid.RenderTransform>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*"/>
                                                    <RowDefinition Height="*"/>
                                                    <RowDefinition Height="*"/>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <Line X1="0" Y1="0" X2="1" Y2="0" Stretch="Fill" Stroke="{StaticResource Brush.ChartGrid}" StrokeThickness="1" StrokeDashArray="4 6" Grid.Row="1" Grid.ColumnSpan="5" VerticalAlignment="Top"/>
                                                <Line X1="0" Y1="0" X2="1" Y2="0" Stretch="Fill" Stroke="{StaticResource Brush.ChartGrid}" StrokeThickness="1" StrokeDashArray="4 6" Grid.Row="2" Grid.ColumnSpan="5" VerticalAlignment="Top"/>
                                                <Line X1="0" Y1="0" X2="1" Y2="0" Stretch="Fill" Stroke="{StaticResource Brush.ChartGrid}" StrokeThickness="1" StrokeDashArray="4 6" Grid.Row="3" Grid.ColumnSpan="5" VerticalAlignment="Top"/>

                                                <Line X1="0" Y1="0" X2="0" Y2="1" Stretch="Fill" Stroke="{StaticResource Brush.ChartGrid}" StrokeThickness="1" StrokeDashArray="4 6" Grid.Column="1" Grid.RowSpan="4" HorizontalAlignment="Left"/>
                                                <Line X1="0" Y1="0" X2="0" Y2="1" Stretch="Fill" Stroke="{StaticResource Brush.ChartGrid}" StrokeThickness="1" StrokeDashArray="4 6" Grid.Column="2" Grid.RowSpan="4" HorizontalAlignment="Left"/>
                                                <Line X1="0" Y1="0" X2="0" Y2="1" Stretch="Fill" Stroke="{StaticResource Brush.ChartGrid}" StrokeThickness="1" StrokeDashArray="4 6" Grid.Column="3" Grid.RowSpan="4" HorizontalAlignment="Left"/>
                                                <Line X1="0" Y1="0" X2="0" Y2="1" Stretch="Fill" Stroke="{StaticResource Brush.ChartGrid}" StrokeThickness="1" StrokeDashArray="4 6" Grid.Column="4" Grid.RowSpan="4" HorizontalAlignment="Left"/>

                                                <ItemsControl Grid.RowSpan="4"
                                                              Grid.ColumnSpan="5"
                                                              ItemsSource="{Binding DamageSeries}"
                                                              IsHitTestVisible="True">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <Canvas Width="480" Height="186.67"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Canvas Width="480" Height="186.67">
                                                                <Polyline Points="{Binding Points}"
                                                                          Stroke="{Binding Stroke}"
                                                                          StrokeThickness="3"
                                                                          StrokeEndLineCap="Round"
                                                                          StrokeStartLineCap="Round"/>
                                                                <ItemsControl ItemsSource="{Binding Markers}">
                                                                    <ItemsControl.ItemsPanel>
                                                                        <ItemsPanelTemplate>
                                                                            <Canvas Width="480" Height="186.67"/>
                                                                        </ItemsPanelTemplate>
                                                                    </ItemsControl.ItemsPanel>
                                                                    <ItemsControl.ItemTemplate>
                                                                        <DataTemplate>
                                                                            <StackPanel Canvas.Left="{Binding PlotPoint.X}"
                                                                                        Canvas.Top="{Binding PlotPoint.Y}"
                                                                                        Margin="-4,-4,0,0"
                                                                                        HorizontalAlignment="Center"
                                                                                        ToolTip="{Binding Tooltip}">
                                                                                <Ellipse Width="8"
                                                                                         Height="8"
                                                                                         Fill="{Binding DataContext.Stroke, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                                                         StrokeThickness="0.5"
                                                                                         Stroke="{StaticResource Brush.Border}"/>
                                                                                <TextBlock Text="{Binding Label}"
                                                                                           Visibility="{Binding ShowLabel, Converter={StaticResource BoolToVisibilityConverter}}"
                                                                                           Style="{StaticResource Text.Caption}"
                                                                                           Margin="-8,6,-8,0"
                                                                                           TextAlignment="Center"/>
                                                                            </StackPanel>
                                                                        </DataTemplate>
                                                                    </ItemsControl.ItemTemplate>
                                                                </ItemsControl>
                                                            </Canvas>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Grid>
                                            <Rectangle x:Name="ChartInteractionLayer"
                                                       Fill="Transparent"
                                                       MouseWheel="ChartInteractionLayer_OnMouseWheel"
                                                       MouseDown="ChartInteractionLayer_OnMouseDown"
                                                       MouseMove="ChartInteractionLayer_OnMouseMove"
                                                       MouseUp="ChartInteractionLayer_OnMouseUp"
                                                       MouseLeave="ChartInteractionLayer_OnMouseLeave"/>
                                        </Grid>
                                    </Grid>
                                </Border>

                                <Grid Grid.Row="2" Grid.Column="1" Margin="6,4,6,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="{Binding XAxisMinLabel}"
                                               Grid.Column="0"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Center"
                                               FontSize="{Binding AxisLabelFontSize}"
                                               Foreground="{StaticResource Brush.TextSecondary}">
                                        <TextBlock.RenderTransform>
                                            <TranslateTransform X="{Binding AxisLabelOffsetX}" Y="{Binding AxisLabelOffsetY}"/>
                                        </TextBlock.RenderTransform>
                                    </TextBlock>
                                    <TextBlock Text="{Binding XAxisMidLabel}"
                                               Grid.Column="2"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="{Binding AxisLabelFontSize}"
                                               Foreground="{StaticResource Brush.TextSecondary}">
                                        <TextBlock.RenderTransform>
                                            <TranslateTransform X="{Binding AxisLabelOffsetX}" Y="{Binding AxisLabelOffsetY}"/>
                                        </TextBlock.RenderTransform>
                                    </TextBlock>
                                    <TextBlock Text="{Binding XAxisMaxLabel}"
                                               Grid.Column="3"
                                               HorizontalAlignment="Right"
                                               VerticalAlignment="Center"
                                               FontSize="{Binding AxisLabelFontSize}"
                                               Foreground="{StaticResource Brush.TextSecondary}">
                                        <TextBlock.RenderTransform>
                                            <TranslateTransform X="{Binding AxisLabelOffsetX}" Y="{Binding AxisLabelOffsetY}"/>
                                        </TextBlock.RenderTransform>
                                    </TextBlock>
                                </Grid>

                                <TextBox Grid.Row="3"
                                         Grid.Column="1"
                                         Text="{Binding EditableXAxisTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         FontWeight="SemiBold"
                                         FontSize="{Binding AxisTitleFontSize}"
                                         Foreground="{StaticResource Brush.TextPrimary}"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         TextAlignment="Center"
                                         HorizontalContentAlignment="Center">
                                    <TextBox.RenderTransform>
                                        <TranslateTransform X="{Binding XAxisTitleOffsetX}" Y="{Binding XAxisTitleOffsetY}"/>
                                    </TextBox.RenderTransform>
                                </TextBox>
                            </Grid>
                        </Viewbox>
                    </StackPanel>
                </Border>

                <Border Background="{StaticResource Brush.Surface}"
                        CornerRadius="10"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        Padding="{StaticResource Padding.Content}">
                    <StackPanel>
                        <TextBlock Text="Expected Annual Damage Results"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding Results}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Damage Column"
                                                    Binding="{Binding Label}"
                                                    Width="*"/>
                                <DataGridTextColumn Header="Expected Annual Damage"
                                                    Binding="{Binding Result}"
                                                    Width="220"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
