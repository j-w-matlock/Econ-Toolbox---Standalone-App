<UserControl x:Class="EconToolbox.Desktop.Views.EadView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="clr-namespace:EconToolbox.Desktop.Behaviors"
             xmlns:controls="clr-namespace:EconToolbox.Desktop.Views.Controls"
             xmlns:sys="clr-namespace:System;assembly=System.Runtime"
             Background="{DynamicResource App.SurfaceAlt}"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True">
    <Grid>
        <ScrollViewer Style="{StaticResource ScrollViewer.Page}">
            <StackPanel>
                <Border Style="{StaticResource Border.Explainer}">
                    <StackPanel>
                        <Grid VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="18"
                                       Foreground="{DynamicResource App.Accent}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1"
                                       Text="Expected Annual Damage"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       Foreground="{DynamicResource App.Accent}"
                                       TextWrapping="Wrap"/>
                        </Grid>
                        <TextBlock TextWrapping="Wrap"
                                   Margin="0,6,0,0">
                            Add stage/frequency and damage values for each category, then use the buttons below to compare scenarios and visualize the curves. Select Calculate after updates so the chart and summary outputs stay synchronized.
                        </TextBlock>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource Border.Card}"
                        Margin="0,0,0,12">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <Button Command="{Binding AddDamageColumnCommand}"
                                Style="{StaticResource Button.Action}"
                                Margin="0,0,12,0"
                                ToolTip="Append a new damage column for an additional category or scenario.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                <TextBlock Text="Add Damage Column"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding RemoveDamageColumnCommand}"
                                Style="{StaticResource Button.Action}"
                                Margin="0,0,12,0"
                                ToolTip="Remove the most recently added damage column.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                <TextBlock Text="Remove Damage Column"/>
                            </StackPanel>
                        </Button>
                        <CheckBox IsChecked="{Binding UseStage}"
                                  VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                ToolTip="Toggle to add a stage column so you can enter paired stage values."/>
                                <TextBlock Text="Include Stage" Margin="4,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </CheckBox>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource Border.Card}"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock Text="Stage / Frequency / Damage Inputs"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding Rows}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="True"
                                  CanUserDeleteRows="True"
                                  HeadersVisibility="Column"
                                  ColumnWidth="SizeToHeader"
                                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                  Margin="0"
                                  behaviors:DataGridColumnsBehavior.ColumnsSource="{Binding ColumnDefinitions}"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource Border.Card}"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBox Text="{Binding ChartTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="16"
                                 FontWeight="SemiBold"
                                 HorizontalAlignment="Center"
                                 Margin="0,0,0,12"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 TextAlignment="Center"
                                 HorizontalContentAlignment="Center"/>
                        <TextBlock Text="Graph shows frequency-damage or stage-damage curves for each column so you can visually confirm the inputs."
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,12"
                                   Foreground="{DynamicResource App.TextSecondary}"/>
                        <ItemsControl ItemsSource="{Binding LegendItems}"
                                      Margin="0,0,0,12">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,12,4">
                                        <Ellipse Width="12"
                                                 Height="12"
                                                 Fill="{Binding Color}"
                                                 Stroke="{DynamicResource App.Border}"
                                                 StrokeThickness="0.5"
                                                 Margin="0,0,6,0"/>
                                        <TextBlock Text="{Binding Name}"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Border Background="{DynamicResource App.ChartFill}"
                                BorderBrush="{DynamicResource App.Border}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="8">
                            <controls:LineGraphControl Height="420"
                                                       MinHeight="320"
                                                       Series="{Binding ChartSeries}"
                                                       IsStageAxis="{Binding UseStage}"
                                                       EmptyMessage="{Binding ChartStatusMessage}"/>
                        </Border>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource Border.Card}">
                    <StackPanel>
                        <TextBlock Text="Expected Annual Damage Results"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding Results}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  IsReadOnly="True"
                                  ColumnWidth="SizeToHeader">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Damage Column"
                                                    Binding="{Binding Label}"
                                                    Width="SizeToHeader"/>
                                <DataGridTextColumn Header="Expected Annual Damage"
                                                    Binding="{Binding Result}"
                                                    Width="SizeToHeader"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
