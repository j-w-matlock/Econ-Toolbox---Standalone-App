<UserControl x:Class="EconToolbox.Desktop.Views.EadView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="clr-namespace:EconToolbox.Desktop.Behaviors"
             xmlns:controls="clr-namespace:EconToolbox.Desktop.Views.Controls"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True">
    <Grid>
        <ScrollViewer Focusable="False"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      Padding="{StaticResource Padding.Card}">
            <StackPanel>
                <TextBlock Text="Expected Annual Damage"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource Brush.Primary}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,12"/>

                <Border Background="{StaticResource Brush.Surface}"
                        CornerRadius="8"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        Padding="{StaticResource Padding.Content}"
                        Margin="0,0,0,12">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Command="{Binding AddDamageColumnCommand}"
                                Padding="12,6"
                                Margin="0,0,12,0"
                                ToolTip="Append a new damage column for an additional category or scenario.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                <TextBlock Text="Add Damage Column"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding RemoveDamageColumnCommand}"
                                Padding="12,6"
                                Margin="0,0,12,0"
                                ToolTip="Remove the most recently added damage column.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                <TextBlock Text="Remove Damage Column"/>
                            </StackPanel>
                        </Button>
                        <CheckBox IsChecked="{Binding UseStage}"
                                  VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                ToolTip="Toggle to add a stage column so you can enter paired stage values."/>
                                <TextBlock Text="Include Stage" Margin="4,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </CheckBox>
                    </StackPanel>
                </Border>

                <Border Background="{StaticResource Brush.Surface}"
                        CornerRadius="10"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        Padding="{StaticResource Padding.Content}"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBlock Text="Stage / Frequency / Damage Inputs"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding Rows}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="True"
                                  CanUserDeleteRows="True"
                                  HeadersVisibility="Column"
                                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                  Margin="0"
                                  behaviors:DataGridColumnsBehavior.ColumnsSource="{Binding ColumnDefinitions}"/>
                    </StackPanel>
                </Border>

                <Border Background="{StaticResource Brush.Surface}"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="{StaticResource Padding.Content}"
                        Margin="0,0,0,12">
                    <StackPanel>
                        <TextBox Text="{Binding ChartTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="16"
                                 FontWeight="SemiBold"
                                 HorizontalAlignment="Center"
                                 Margin="0,0,0,12"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 TextAlignment="Center"
                                 HorizontalContentAlignment="Center"/>
                        <TextBlock Text="Graph shows frequency-damage or stage-damage curves for each column so you can visually confirm the inputs."
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,12"
                                   Foreground="{StaticResource Brush.TextSecondary}"/>
                        <ItemsControl ItemsSource="{Binding LegendItems}"
                                      Margin="0,0,0,12">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,12,4">
                                        <Ellipse Width="12"
                                                 Height="12"
                                                 Fill="{Binding Color}"
                                                 Stroke="{StaticResource Brush.Border}"
                                                 StrokeThickness="0.5"
                                                 Margin="0,0,6,0"/>
                                        <TextBlock Text="{Binding Name}"
                                                   VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Border Background="{StaticResource Brush.ChartFill}"
                                BorderBrush="{StaticResource Brush.Border}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="8">
                            <controls:LineGraphControl Height="420"
                                                       MinHeight="320"
                                                       Series="{Binding ChartSeries}"
                                                       IsStageAxis="{Binding UseStage}"
                                                       EmptyMessage="{Binding ChartStatusMessage}"/>
                        </Border>
                    </StackPanel>
                </Border>

                <Border Background="{StaticResource Brush.Surface}"
                        CornerRadius="10"
                        BorderBrush="{StaticResource Brush.Border}"
                        BorderThickness="1"
                        Padding="{StaticResource Padding.Content}">
                    <StackPanel>
                        <TextBlock Text="Expected Annual Damage Results"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding Results}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  HeadersVisibility="Column"
                                  IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Damage Column"
                                                    Binding="{Binding Label}"
                                                    Width="*"/>
                                <DataGridTextColumn Header="Expected Annual Damage"
                                                    Binding="{Binding Result}"
                                                    Width="220"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
