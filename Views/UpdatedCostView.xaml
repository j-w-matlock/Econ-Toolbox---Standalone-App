<UserControl x:Class="EconToolbox.Desktop.Views.UpdatedCostView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True">
    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" Padding="{StaticResource Padding.Card}">
        <StackPanel>
        <Border Margin="10,0,10,10"
                Style="{StaticResource Border.Explainer}"
                Padding="{StaticResource Padding.Card}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Column="0" VerticalAlignment="Top">
                    <Viewbox Width="32" Height="32" Margin="0,0,10,0">
                        <Canvas Width="32" Height="32">
                            <Rectangle Width="24"
                                       Height="16"
                                       RadiusX="2"
                                       RadiusY="2"
                                       Fill="{StaticResource Brush.Primary}"
                                       Canvas.Left="4"
                                       Canvas.Top="8"/>
                            <Rectangle Width="4" Height="12" Fill="{StaticResource Brush.Surface}" Opacity="0.6" Canvas.Left="6" Canvas.Top="10"/>
                            <Rectangle Width="4" Height="12" Fill="{StaticResource Brush.Surface}" Opacity="0.6" Canvas.Left="14" Canvas.Top="10"/>
                            <Rectangle Width="4" Height="12" Fill="{StaticResource Brush.Surface}" Opacity="0.6" Canvas.Left="22" Canvas.Top="10"/>
                            <Path Data="M4,24 C7,22 9,22 12,24 C15,26 17,26 20,24 C23,22 25,22 28,24"
                                  Stroke="{StaticResource Brush.Accent}"
                                  StrokeThickness="2"
                                  StrokeStartLineCap="Round"
                                  StrokeEndLineCap="Round"
                                  Fill="Transparent"/>
                        </Canvas>
                    </Viewbox>
                </StackPanel>
                <StackPanel Grid.Column="1">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Grid.Row" Value="0"/>
                            <Setter Property="Grid.ColumnSpan" Value="1"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Border}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                             Value="Narrow">
                                    <Setter Property="Grid.ColumnSpan" Value="2"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="Updated Cost Workflow" FontSize="18" FontWeight="Bold" Foreground="{StaticResource Brush.Primary}"/>
                    <TextBlock Style="{StaticResource Text.Body}" Margin="0,6,0,0">
                        <Run Text="• Work through each sub-tab from left to right so dependent calculations stay aligned."/>
                        <LineBreak/>
                        <Run Text="• Start with storage capacity, capture annual joint costs, then update historical line items."/>
                        <LineBreak/>
                        <Run Text="• Evaluate RR&amp;R, mitigation, and total annual cost scenarios once upstream inputs are finalized."/>
                        <LineBreak/>
                        <Run Text="• Press Compute within each section before leaving the tab to keep downstream values synchronized."/>
                    </TextBlock>
                </StackPanel>
                <Canvas Width="80" Height="60">
                    <Canvas.Style>
                        <Style TargetType="Canvas">
                            <Setter Property="Grid.Column" Value="2"/>
                            <Setter Property="Grid.Row" Value="0"/>
                            <Setter Property="Margin" Value="15,0,0,0"/>
                            <Setter Property="HorizontalAlignment" Value="Right"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Border}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                             Value="Narrow">
                                    <Setter Property="Grid.Column" Value="0"/>
                                    <Setter Property="Grid.Row" Value="1"/>
                                    <Setter Property="Margin" Value="0,12,0,0"/>
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Canvas.Style>
                    <Rectangle Width="70" Height="40" Fill="White" Stroke="{StaticResource Brush.Accent}" RadiusX="6" RadiusY="6" Canvas.Left="5" Canvas.Top="15"/>
                    <Polyline Points="5,45 25,25 45,30 65,10" Stroke="{StaticResource Brush.Primary}" StrokeThickness="3" StrokeEndLineCap="Round" StrokeStartLineCap="Round"/>
                    <Ellipse Width="8" Height="8" Fill="{StaticResource Brush.Accent}" Canvas.Left="1" Canvas.Top="41"/>
                    <Ellipse Width="8" Height="8" Fill="{StaticResource Brush.Accent}" Canvas.Left="21" Canvas.Top="21"/>
                    <Ellipse Width="8" Height="8" Fill="{StaticResource Brush.Accent}" Canvas.Left="41" Canvas.Top="26"/>
                    <Ellipse Width="8" Height="8" Fill="{StaticResource Brush.Accent}" Canvas.Left="61" Canvas.Top="6"/>
                </Canvas>
            </Grid>
        </Border>
        <TabControl Margin="10,0,10,10" HorizontalContentAlignment="Stretch">
        <TabItem Header="Storage Cost">
            <StackPanel Margin="10">
                <Border Style="{StaticResource Border.Explainer}" Margin="0,0,0,12">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="18"
                                       Foreground="{StaticResource Brush.Primary}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Text="Storage Guidance"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Brush.Primary}"/>
                        </StackPanel>
                        <TextBlock Style="{StaticResource Text.Body}" Margin="0,6,0,0">
                            <Run Text="• Record the full system storage and the recommended allocation for your study."/>
                            <LineBreak/>
                            <Run Text="• Use Compute to scale the remaining sections by this proportion before moving forward."/>
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Grid Margin="0,10,0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Enter the system's total usable storage before any plan allocation."/>
                        </InlineUIContainer>
                        <Run Text="Total Usable Storage"/>
                    </TextBlock>
                    <TextBox Text="{Binding TotalStorage}" Grid.Column="1" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="1" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Recommended portion of the joint storage allocated to this alternative."/>
                        </InlineUIContainer>
                        <Run Text="Storage Recommendation"/>
                    </TextBlock>
                    <TextBox Text="{Binding StorageRecommendation}" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>
                    <Button Command="{Binding ComputeStorageCommand}" Grid.Row="2" Grid.ColumnSpan="2" Margin="0,5,0,5">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text="&#xE8EF;"
                                       FontSize="18"
                                       Margin="0,0,6,0"/>
                            <TextBlock Text="Compute"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Text="{Binding Percent, StringFormat=P: {0:F5}}" Grid.Row="3" Grid.ColumnSpan="2" ToolTip="Percent = Storage Recommendation / Total Usable Storage"/>
                </Grid>
                <Border Style="{StaticResource Border.ResultInfo}" Margin="0">
                    <TextBlock TextWrapping="Wrap">
                        The resulting P value shows how much of the joint facilities support your recommendation. Increasing the recommendation or decreasing total storage raises the percentage and, consequently, the share of downstream costs assigned to this project.
                    </TextBlock>
                </Border>
            </StackPanel>
        </TabItem>
        <TabItem Header="Joint Costs O&amp;M">
            <StackPanel Margin="10">
                <Border Style="{StaticResource Border.Explainer}" Margin="0,0,0,12">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="18"
                                       Foreground="{StaticResource Brush.Primary}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Text="Joint O&amp;M Entry"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Brush.Primary}"/>
                        </StackPanel>
                        <TextBlock Style="{StaticResource Text.Body}" Margin="0,6,0,0">
                            <Run Text="• Enter system-wide joint operating and maintenance costs on an annual basis."/>
                            <LineBreak/>
                            <Run Text="• Use Compute to capture the running total that will later be scaled by the storage percentage."/>
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Grid Margin="0,10,0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Annual system-wide joint operations expense before scaling."/>
                        </InlineUIContainer>
                        <Run Text="Joint Operations Cost"/>
                    </TextBlock>
                    <TextBox Text="{Binding JointOperationsCost, Converter={StaticResource CurrencyConverter}}"
                             Grid.Column="1"
                             Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="1" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Annual joint maintenance expense for the entire system."/>
                        </InlineUIContainer>
                        <Run Text="Joint Maintenance Cost"/>
                    </TextBlock>
                    <TextBox Text="{Binding JointMaintenanceCost, Converter={StaticResource CurrencyConverter}}"
                             Grid.Row="1"
                             Grid.Column="1"
                             Margin="0,0,0,5"/>
                    <Button Grid.Row="2" Grid.ColumnSpan="2" Margin="0,5,0,5" Command="{Binding ComputeJointCommand}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text="&#xE8EF;"
                                       FontSize="18"
                                       Margin="0,0,6,0"/>
                            <TextBlock Text="Compute"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Text="{Binding TotalJointOm, StringFormat=Total Joint O&amp;M: {0:C2}}" Grid.Row="3" Grid.ColumnSpan="2" ToolTip="Total Joint O&amp;M = Joint Operations Cost + Joint Maintenance Cost"/>
                </Grid>
                <Border Style="{StaticResource Border.ResultInfo}" Margin="0">
                    <TextBlock TextWrapping="Wrap">
                        This total represents the joint-system expenses before scaling. When the storage percentage increases, more of this amount will be allocated to the recommended plan in the Total Annual Cost tab.
                    </TextBlock>
                </Border>
            </StackPanel>
        </TabItem>
        <TabItem Header="Updated Storage Cost">
            <StackPanel Margin="10">
                <Border Style="{StaticResource Border.Explainer}" Margin="0,0,0,12">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="18"
                                       Foreground="{StaticResource Brush.Primary}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Text="Update Legacy Costs"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Brush.Primary}"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Margin="0,6,0,0">
                            Replace historical construction costs with current values by pairing each category with the proper update factor. Keep the categories clear so the export remains audit friendly.
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Grid Margin="0,8,0,10">
                    <Grid.Resources>
                        <Style TargetType="TextBlock" x:Key="UpdatedCostLabelTextStyle">
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Margin" Value="0,0,0,4"/>
                        </Style>
                    </Grid.Resources>
                    <UniformGrid Columns="3" Margin="0,0,0,0">
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="Pre-construction Mid-Point Year" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding PreMidpointYear}" HorizontalContentAlignment="Right" ToolTip="Year used to label the original construction mid-point joint-use column."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="Transition Mid-Point Year" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding TransitionMidpointYear}" HorizontalContentAlignment="Right" ToolTip="Year used to label the transition mid-point joint-use column."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="Original ENR Index Year" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding PreEnrYear}" HorizontalContentAlignment="Right" ToolTip="Year associated with the initial ENR index values."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="Original ENR Index Value" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding PreEnrIndexValue}" HorizontalContentAlignment="Right" ToolTip="ENR index value tied to the original pre-construction year."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="Transition ENR Index Year" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding TransitionEnrYear}" HorizontalContentAlignment="Right" ToolTip="Year associated with the transition ENR index values."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="Transition ENR Index Value" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding TransitionEnrIndexValue}" HorizontalContentAlignment="Right" ToolTip="ENR index value used for the transition mid-point."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="1967 ENR Index Year" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding Enr1967Year}" HorizontalContentAlignment="Right" ToolTip="Year anchoring the ENR and CWCCIS indexing, typically 1967."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,8">
                            <TextBlock Text="1967 ENR Index Value" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding Enr1967IndexValue}" HorizontalContentAlignment="Right" ToolTip="ENR index value for the 1967 base year."/>
                        </StackPanel>
                        <StackPanel Margin="0,0,12,0">
                            <TextBlock Text="1967 CWCCIS Base Index Value" Style="{StaticResource UpdatedCostLabelTextStyle}"/>
                            <TextBox Text="{Binding CwccisBaseIndexValue}" HorizontalContentAlignment="Right" ToolTip="CWCCIS base index value for 1967 (commonly 100)."/>
                        </StackPanel>
                    </UniformGrid>
                </Grid>
                <DataGrid ItemsSource="{Binding UpdatedCostItems}"
                          AutoGenerateColumns="False"
                          Height="220"
                          Margin="0,0,0,5"
                          ScrollViewer.HorizontalScrollBarVisibility="Auto"
                          ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <DataGrid.Resources>
                        <Style x:Key="NumericCellStyle" TargetType="TextBlock">
                            <Setter Property="TextAlignment" Value="Right"/>
                            <Setter Property="Padding" Value="0,0,4,0"/>
                        </Style>
                        <Style x:Key="NumericEditingStyle" TargetType="TextBox">
                            <Setter Property="HorizontalContentAlignment" Value="Right"/>
                        </Style>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <DataGridTextColumn Binding="{Binding Category}">
                            <DataGridTextColumn.Header>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                    ToolTip="Name or description of the cost item being escalated."/>
                                    <TextBlock Text="Category" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn ElementStyle="{StaticResource NumericCellStyle}" EditingElementStyle="{StaticResource NumericEditingStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="JointUsePre1967" Converter="{StaticResource CurrencyConverter}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                    ToolTip="Joint-use cost at the mid-point of construction using the original ENR year."/>
                                    <TextBlock Margin="4,0,0,0"
                                               VerticalAlignment="Center"
                                               Text="{Binding DataContext.ActualJointUsePreLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                                </StackPanel>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn Binding="{Binding Pre1967EnrIndex}"
                                           ElementStyle="{StaticResource NumericCellStyle}"
                                           EditingElementStyle="{StaticResource NumericEditingStyle}"
                                           Header="{Binding DataContext.PreEnrIndexLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                        <DataGridTextColumn Binding="{Binding TransitionEnrIndex}"
                                           ElementStyle="{StaticResource NumericCellStyle}"
                                           EditingElementStyle="{StaticResource NumericEditingStyle}"
                                           Header="{Binding DataContext.TransitionEnrIndexLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                        <DataGridTextColumn IsReadOnly="True" ElementStyle="{StaticResource NumericCellStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="EnrRatioPreToTransition" StringFormat="{}{0:N2}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <TextBlock Text="{Binding DataContext.EnrRatioPreToTransitionLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn IsReadOnly="True" ElementStyle="{StaticResource NumericCellStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="JointUseTransition" Converter="{StaticResource CurrencyConverter}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <TextBlock Text="{Binding DataContext.ActualJointUseTransitionLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn IsReadOnly="True" ElementStyle="{StaticResource NumericCellStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="TransitionEnrIndex"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <TextBlock Text="{Binding DataContext.TransitionEnrIndexLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn Binding="{Binding Enr1967Index}"
                                           ElementStyle="{StaticResource NumericCellStyle}"
                                           EditingElementStyle="{StaticResource NumericEditingStyle}"
                                           Header="{Binding DataContext.Enr1967IndexLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                        <DataGridTextColumn IsReadOnly="True" ElementStyle="{StaticResource NumericCellStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="EnrRatioTransitionTo1967" StringFormat="{}{0:N2}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <TextBlock Text="{Binding DataContext.EnrRatioTransitionTo1967Label, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn Binding="{Binding CwccisBase}"
                                           ElementStyle="{StaticResource NumericCellStyle}"
                                           EditingElementStyle="{StaticResource NumericEditingStyle}"
                                           Header="{Binding DataContext.CwccisBaseLabel, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                        <DataGridTextColumn IsReadOnly="True" ElementStyle="{StaticResource NumericCellStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="JointUse1967" Converter="{StaticResource CurrencyConverter}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <TextBlock Text="{Binding DataContext.JointUse1967Label, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn Binding="{Binding CwccisIndex}"
                                           ElementStyle="{StaticResource NumericCellStyle}"
                                           EditingElementStyle="{StaticResource NumericEditingStyle}"
                                           Header="Mar 2019 CWCCIS Index Value"/>
                        <DataGridTextColumn IsReadOnly="True" ElementStyle="{StaticResource NumericCellStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="CwccisUpdateFactor" StringFormat="{}{0:N5}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <TextBlock Text="CWCCIS Update Value"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                        <DataGridTextColumn IsReadOnly="True" ElementStyle="{StaticResource NumericCellStyle}">
                            <DataGridTextColumn.Binding>
                                <Binding Path="UpdatedJointCost" Converter="{StaticResource CurrencyConverter}"/>
                            </DataGridTextColumn.Binding>
                            <DataGridTextColumn.Header>
                                <TextBlock Text="FY 2020 Joint Costs"/>
                            </DataGridTextColumn.Header>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
                <Button Margin="0,4,0,4" Command="{Binding ResetUpdatedCostItemsCommand}" HorizontalAlignment="Right">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE72C;" FontSize="16" Margin="0,0,6,0"/>
                        <TextBlock Text="Reset Table"/>
                    </StackPanel>
                </Button>
                <Button Margin="0,5,0,5" Command="{Binding ComputeUpdatedStorageCommand}">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text="&#xE8EF;"
                                   FontSize="18"
                                   Margin="0,0,6,0"/>
                        <TextBlock Text="Compute"/>
                    </StackPanel>
                </Button>
                <Border Style="{StaticResource Border.ResultInfo}" Margin="0">
                    <StackPanel>
                        <TextBlock Text="{Binding TotalUpdatedCost, StringFormat=Total FY 2020 Joint Cost: {0:C2}}" FontWeight="Bold"/>
                        <TextBlock TextWrapping="Wrap" Margin="0,6,0,0">
                            Each line item is escalated from the original ENR year to the 1967 CWCCIS base and then multiplied by the CWCCIS update value. The resulting total carries forward into the capital cost scenarios.
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>
        </TabItem>
        <TabItem Header="RR&amp;R and Mitigation">
            <StackPanel Margin="10">
                <Border Style="{StaticResource Border.Explainer}" Margin="0,0,0,12">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="18"
                                       Foreground="{StaticResource Brush.Primary}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Text="RR&amp;R / Mitigation Planner"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Brush.Primary}"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Margin="0,6,0,0">
                            Capture future repair, replacement, rehabilitation, and mitigation costs. Use the grid to list each activity, the year it occurs, and its cost in that year dollars. The tool discounts everything back to the base year before applying the CWCCI.
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Grid Margin="0,10,0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Real federal discount rate applied to future RR&amp;R and mitigation costs."/>
                        </InlineUIContainer>
                        <Run Text="Federal Discount Rate (%)"/>
                    </TextBlock>
                    <TextBox Text="{Binding RrrRate}" Grid.Column="1" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="1" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Number of years used when discounting recurring RR&amp;R and mitigation items."/>
                        </InlineUIContainer>
                        <Run Text="Analysis Years"/>
                    </TextBlock>
                    <TextBox Text="{Binding RrrPeriods}" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="2" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Civil Works Construction Cost Index factor applied after discounting."/>
                        </InlineUIContainer>
                        <Run Text="CWCCI"/>
                    </TextBlock>
                    <TextBox Text="{Binding RrrCwcci}" Grid.Row="2" Grid.Column="1" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="3" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Reference year to which all RR&amp;R and mitigation costs are discounted."/>
                        </InlineUIContainer>
                        <Run Text="Base Year"/>
                    </TextBlock>
                    <TextBox Text="{Binding RrrBaseYear}" Grid.Row="3" Grid.Column="1" Margin="0,0,0,5"/>
                    <DataGrid ItemsSource="{Binding RrrCostItems}" AutoGenerateColumns="False" Grid.Row="4" Grid.ColumnSpan="2" Height="150" Margin="0,0,0,5" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <DataGrid.Columns>
                            <DataGridTextColumn Binding="{Binding Item}">
                                <DataGridTextColumn.Header>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                        ToolTip="Name of the repair, replacement, rehabilitation, or mitigation activity."/>
                                        <TextBlock Text="Item" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>
                            <DataGridTextColumn>
                                <DataGridTextColumn.Binding>
                                    <Binding Path="FutureCost" Converter="{StaticResource CurrencyConverter}"/>
                                </DataGridTextColumn.Binding>
                                <DataGridTextColumn.Header>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                        ToolTip="Cost of the activity stated in the year it occurs."/>
                                        <TextBlock Text="Future Cost" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>
                            <DataGridTextColumn Binding="{Binding Year}">
                                <DataGridTextColumn.Header>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <ContentControl Style="{StaticResource Content.InfoIcon}"
                                                        ToolTip="Calendar year when the activity is scheduled."/>
                                        <TextBlock Text="Year" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="PV Factor" Binding="{Binding PvFactor}" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Present Value" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="PresentValue" Converter="{StaticResource CurrencyConverter}"/>
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    <Button Grid.Row="5" Grid.ColumnSpan="2" Margin="0,4,0,4" Command="{Binding ResetRrrItemsCommand}" HorizontalAlignment="Right">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE72C;" FontSize="16" Margin="0,0,6,0"/>
                            <TextBlock Text="Reset Table"/>
                        </StackPanel>
                    </Button>
                    <Button Grid.Row="6" Grid.ColumnSpan="2" Margin="0,5,0,5" Command="{Binding ComputeRrrCommand}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text="&#xE8EF;"
                                       FontSize="18"
                                       Margin="0,0,6,0"/>
                            <TextBlock Text="Compute"/>
                        </StackPanel>
                    </Button>
                    <StackPanel Grid.Row="7" Grid.ColumnSpan="2">
                        <TextBlock Text="{Binding RrrUpdatedCost, StringFormat=Updated Cost: {0:C2}}" ToolTip="Updated Cost = Present Value × CWCCI" FontWeight="Bold" Margin="0,0,0,4"/>
                        <TextBlock Text="{Binding RrrAnnualized, StringFormat=Annualized: {0:C2}}" ToolTip="Annualized = Updated Cost × CRF" FontWeight="Bold"/>
                    </StackPanel>
                </Grid>
                <Border Style="{StaticResource Border.ResultInfo}" Margin="0">
                    <TextBlock TextWrapping="Wrap">
                        Present Value aggregates each scheduled cost using the discount rate and base year. The Updated Cost multiplies that total by CWCCI, and the Annualized figure then applies your capital recovery factor. Larger future costs, slower discounting, or higher CWCCI will elevate every downstream total.
                    </TextBlock>
                </Border>
            </StackPanel>
        </TabItem>
        <TabItem Header="Total Annual Cost">
            <StackPanel Margin="10">
                <Border Style="{StaticResource Border.Explainer}" Margin="0,0,0,12">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="18"
                                       Foreground="{StaticResource Brush.Primary}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Text="Compare Annual Cost Scenarios"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource Brush.Primary}"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Margin="0,6,0,0">
                            Define up to two capital recovery scenarios. Each uses its own discount rate and analysis period to annualize the updated costs, then layers on scaled joint O&amp;M and RR&amp;R/mitigation values.
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Grid Margin="0,10,0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Discount rate used for the first annualization scenario."/>
                        </InlineUIContainer>
                        <Run Text="Discount Rate 1 (%)"/>
                    </TextBlock>
                    <TextBox Text="{Binding DiscountRate1}" Grid.Column="1" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="1" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Number of years in the first capital recovery scenario."/>
                        </InlineUIContainer>
                        <Run Text="Analysis Period 1"/>
                    </TextBlock>
                    <TextBox Text="{Binding AnalysisPeriod1}" Grid.Row="1" Grid.Column="1" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="2" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Discount rate for the second comparison scenario."/>
                        </InlineUIContainer>
                        <Run Text="Discount Rate 2 (%)"/>
                    </TextBlock>
                    <TextBox Text="{Binding DiscountRate2}" Grid.Row="2" Grid.Column="1" Margin="0,0,0,5"/>
                    <TextBlock Grid.Row="3" Margin="0,0,5,5">
                        <InlineUIContainer BaselineAlignment="Center">
                            <ContentControl Style="{StaticResource Content.InfoIcon}"
                                            ToolTip="Years covered by the second capital recovery scenario."/>
                        </InlineUIContainer>
                        <Run Text="Analysis Period 2"/>
                    </TextBlock>
                    <TextBox Text="{Binding AnalysisPeriod2}" Grid.Row="3" Grid.Column="1" Margin="0,0,0,5"/>
                    <Button Grid.Row="4" Grid.ColumnSpan="2" Margin="0,5,0,5" Command="{Binding ComputeTotalCommand}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text="&#xE8EF;"
                                       FontSize="18"
                                       Margin="0,0,6,0"/>
                            <TextBlock Text="Compute"/>
                        </StackPanel>
                    </Button>
                    <Grid Grid.Row="5" Grid.ColumnSpan="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <GroupBox Header="Cost 1" Grid.Column="0" Margin="0,0,5,0">
                            <StackPanel>
                                <TextBlock Text="{Binding Percent, StringFormat=P: {0:F5}}" ToolTip="Percent = Storage Recommendation / Total Usable Storage"/>
                                <TextBlock Text="{Binding CostRecommendation, StringFormat=Cost of Storage Recommendation: {0:C2}}" ToolTip="Cost Recommendation = Total Updated Cost × Percent"/>
                                <TextBlock Text="{Binding Capital1, StringFormat=Annualized Storage Cost 1: {0:C2}}" ToolTip="Annualized Storage Cost 1 = Total Updated Cost × Percent × CRF1"/>
                                <TextBlock Text="{Binding OmScaled, StringFormat=Joint O&amp;M: {0:C2}}" ToolTip="Joint O&amp;M = Total Joint O&amp;M × Percent"/>
                                <TextBlock Text="{Binding RrrScaled, StringFormat=Annualized RR&amp;R/Mitigation: {0:C2}}" ToolTip="Annualized RR&amp;R/Mitigation = RRR Annualized × Percent"/>
                                <TextBlock Text="{Binding Total1, StringFormat=Total Annual Cost 1: {0:C2}}" ToolTip="Total Annual Cost 1 = Capital1 + Joint O&amp;M + Annualized RR&amp;R/Mitigation" FontWeight="Bold"/>
                            </StackPanel>
                        </GroupBox>
                        <GroupBox Header="Cost 2" Grid.Column="1" Margin="5,0,0,0">
                            <StackPanel>
                                <TextBlock Text="{Binding Percent, StringFormat=P: {0:F5}}" ToolTip="Percent = Storage Recommendation / Total Usable Storage"/>
                                <TextBlock Text="{Binding CostRecommendation, StringFormat=Cost of Storage Recommendation: {0:C2}}" ToolTip="Cost Recommendation = Total Updated Cost × Percent"/>
                                <TextBlock Text="{Binding Capital2, StringFormat=Annualized Storage Cost 2: {0:C2}}" ToolTip="Annualized Storage Cost 2 = Total Updated Cost × Percent × CRF2"/>
                                <TextBlock Text="{Binding OmScaled, StringFormat=Joint O&amp;M: {0:C2}}" ToolTip="Joint O&amp;M = Total Joint O&amp;M × Percent"/>
                                <TextBlock Text="{Binding Total2, StringFormat=Total Annual Cost 2: {0:C2}}" ToolTip="Total Annual Cost 2 = Capital2 + Joint O&amp;M" FontWeight="Bold"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </Grid>
                <Border Style="{StaticResource Border.ResultInfo}" Margin="0">
                    <TextBlock TextWrapping="Wrap">
                        Cost 1 and Cost 2 let you compare alternative discounting assumptions. Lower discount rates or longer analysis periods increase the capital recovery factor and therefore annualized storage costs. Because joint O&amp;M and RR&amp;R values scale with the storage percentage, any change you make on earlier tabs will ripple into both scenarios here.
                    </TextBlock>
                </Border>
            </StackPanel>
        </TabItem>
        </TabControl>
        </StackPanel>
    </ScrollViewer>
</UserControl>
