<UserControl x:Class="EconToolbox.Desktop.Views.DrawingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="Root"
             Background="{StaticResource Brush.SurfaceAlt}"
             SnapsToDevicePixels="True"
             UseLayoutRounding="True">
    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  Padding="{StaticResource Padding.Card}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Border Grid.Row="0" Style="{StaticResource Border.Explainer}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock FontFamily="Segoe MDL2 Assets"
                                   Text=""
                                   FontSize="18"
                                   Foreground="{StaticResource Brush.Primary}"
                                   Margin="0,0,8,0"/>
                        <TextBlock Text="Sketch Workspace"
                                   FontWeight="Bold"
                                   FontSize="16"
                                   Foreground="{StaticResource Brush.Primary}"/>
                    </StackPanel>
                    <TextBlock TextWrapping="Wrap" Margin="0,6,0,0">
                        Draw directly on the canvas using your mouse or stylus. Adjust pen color and thickness with the controls below. Use the Calculate button at the bottom of the window when you want to include the latest strokes in the export package.
                    </TextBlock>
                </StackPanel>
            </Border>
            <Border Grid.Row="1" Background="{StaticResource Brush.Surface}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="8" Padding="12" Margin="0,12,0,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <StackPanel Width="240" Margin="0,0,16,0">
                        <TextBlock Text="Pen Color" FontWeight="SemiBold"/>
                        <ListBox ItemsSource="{Binding Palette}"
                                 SelectedValuePath="Color"
                                 SelectedValue="{Binding SelectedColor, Mode=TwoWay}"
                                 Margin="0,6,0,0"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Disabled"
                                 ToolTip="Select the pen color applied to new strokes.">
                            <ListBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ListBox.ItemsPanel>
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Margin" Value="4"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="28" Height="28" CornerRadius="14" BorderBrush="#1F3A7A">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                                                        <Setter Property="BorderThickness" Value="3"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Border Background="{Binding Swatch}" CornerRadius="14"/>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                    <StackPanel Width="180" Margin="0,0,16,0">
                        <TextBlock Text="Pen Thickness" FontWeight="SemiBold"/>
                        <Slider Minimum="1"
                                Maximum="24"
                                TickFrequency="1"
                                IsSnapToTickEnabled="True"
                                Value="{Binding PenThickness, Mode=TwoWay}"
                                Margin="0,6,0,0"
                                ToolTip="Set the stroke thickness in pixels for new strokes."/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom">
                        <Button Command="{Binding UndoCommand}" Width="110" Margin="0,0,8,0" ToolTip="Remove the most recent stroke from the canvas.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="0,0,6,0"/>
                                <TextBlock Text="Undo"/>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding ClearCommand}" Width="110" ToolTip="Erase all strokes from the sketch.">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="0,0,6,0"/>
                                <TextBlock Text="Clear"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>
            <Border Grid.Row="2" Background="White" BorderBrush="#D5E3F6" BorderThickness="1" CornerRadius="10" Padding="6" Margin="0,12,0,0">
                <Grid>
                    <InkCanvas x:Name="Canvas"
                               Strokes="{Binding Strokes}"
                               Background="#FAFCFF"
                               Width="{Binding CanvasWidth}"
                               Height="{Binding CanvasHeight}"
                               EditingMode="Ink"
                               ToolTip="Draw freehand notes, diagrams, or signatures using the selected pen settings."/>
                </Grid>
            </Border>
            <StackPanel Grid.Row="3" Margin="0,16,0,0">
                <Border Style="{StaticResource Border.ResultInfo}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="18" Foreground="{StaticResource Brush.Primary}" Margin="0,0,8,0"/>
                            <TextBlock Text="How to Read the Results" FontWeight="Bold" Foreground="{StaticResource Brush.Primary}"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Margin="0,6,0,0">
                            The canvas preserves every stroke so exported workbooks reproduce the sketch exactly. Pen settings only affect new strokes, so note color and thickness changes if they convey meaning for reviewers.
                        </TextBlock>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource Border.ResultInfo}" Margin="0,12,0,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="18" Foreground="{StaticResource Brush.Primary}" Margin="0,0,8,0"/>
                            <TextBlock Text="Policy Notes" FontWeight="Bold" Foreground="{StaticResource Brush.Primary}"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Margin="0,6,0,0">
                            <Run Text="• Use the sketch pad for conceptual communication only—archive signed drawings and approvals in the official design repository."/>
                            <LineBreak/>
                            <Run Text="• Avoid depicting controlled unclassified information or PII; reference secure systems when necessary."/>
                            <LineBreak/>
                            <Run Text="• When sharing exports, include context in meeting notes so the hand sketch aligns with formal design documentation."/>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</UserControl>
