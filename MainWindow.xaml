<Window x:Class="EconToolbox.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:EconToolbox.Desktop.ViewModels"
        xmlns:views="clr-namespace:EconToolbox.Desktop.Views"
        Title="Economic Toolbox"
        Height="700"
        Width="960"
        MinWidth="640"
        MinHeight="600"
        ResizeMode="CanResize"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True">
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="HeroWideTemplate">
                <Grid Margin="0"
                      HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*" MinWidth="300"/>
                    </Grid.ColumnDefinitions>
                    <Canvas Width="120"
                            Height="80"
                            Margin="{StaticResource Margin.InlineLarge}">
                        <Path Data="M10,70 L30,45 L55,55 L85,20"
                              Stroke="White"
                              StrokeThickness="4"
                              StrokeEndLineCap="Round"
                              StrokeStartLineCap="Round"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="6" Canvas.Top="65"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="26" Canvas.Top="40"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="51" Canvas.Top="50"/>
                        <Ellipse Width="12" Height="12" Fill="White" Canvas.Left="79" Canvas.Top="14"/>
                    </Canvas>
                    <StackPanel Grid.Column="1">
                        <StackPanel Orientation="Horizontal" Margin="{StaticResource Margin.Stack}">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="30"
                                       Foreground="White"
                                       Margin="{StaticResource Margin.Inline}"/>
                            <TextBlock Text="Economic Toolbox"
                                       Style="{StaticResource Text.Title}"/>
                        </StackPanel>
                        <TextBlock Style="{StaticResource Text.Body}"
                                   Foreground="White"
                                   Margin="{StaticResource Margin.Stack}">
                            Review each tab to build a complete project narrative. Enter inputs carefully, press Calculate when
                            available, and use Export to capture your work. Context-sensitive tips below explain what each result
                            means and how your assumptions drive it.
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="HeroNarrowTemplate">
                <StackPanel Margin="0"
                            HorizontalAlignment="Stretch">
                    <Canvas Width="100"
                            Height="70"
                            HorizontalAlignment="Center"
                            Margin="{StaticResource Margin.Stack}">
                        <Path Data="M10,60 L25,35 L45,45 L70,15"
                              Stroke="White"
                              StrokeThickness="4"
                              StrokeEndLineCap="Round"
                              StrokeStartLineCap="Round"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="6" Canvas.Top="55"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="24" Canvas.Top="30"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="44" Canvas.Top="40"/>
                        <Ellipse Width="12" Height="12" Fill="White" Canvas.Left="68" Canvas.Top="10"/>
                    </Canvas>
                    <StackPanel Margin="{StaticResource Margin.Stack}"
                                HorizontalAlignment="Center">
                        <TextBlock Text="Economic Toolbox"
                                   Style="{StaticResource Text.Title}"/>
                    </StackPanel>
                    <TextBlock Style="{StaticResource Text.Body}"
                               Foreground="White"
                               TextAlignment="Center"
                               Margin="{StaticResource Margin.Stack}">
                        Review each tab to build a complete project narrative. Enter inputs carefully, press Calculate when
                        available, and use Export to capture your work. Context-sensitive tips below explain what each result means
                        and how your assumptions drive it.
                    </TextBlock>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="ActionsWideTemplate">
                <Grid HorizontalAlignment="Right"
                      Grid.IsSharedSizeScope="True">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="ActionButtons"/>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="ActionButtons"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="CalculateButton"
                            Command="{Binding CalculateCommand}"
                            Margin="{StaticResource Margin.Inline}"
                            HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Calculate"/>
                        </StackPanel>
                    </Button>
                    <Button Grid.Column="1"
                            Command="{Binding ExportCommand}"
                            HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Export"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ActionsNarrowTemplate">
                <StackPanel>
                    <Button Command="{Binding CalculateCommand}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Calculate"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding ExportCommand}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Export"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </DataTemplate>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Background="{StaticResource Brush.Primary}"
                Padding="{StaticResource Padding.Section}"
                CornerRadius="0,0,12,12">
            <ContentControl Content="{Binding}">
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="ContentTemplate" Value="{StaticResource HeroNarrowTemplate}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                         Value="Wide">
                                <Setter Property="ContentTemplate" Value="{StaticResource HeroWideTemplate}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>
        </Border>

        <Border Grid.Row="1"
                Margin="{StaticResource Margin.Container}"
                Padding="0"
                Background="{StaticResource Brush.SurfaceAlt}"
                CornerRadius="12">
            <ScrollViewer x:Name="MainContentScrollViewer"
                          Focusable="False"
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto"
                          PreviewMouseWheel="MainScrollViewer_PreviewMouseWheel">
                <TabControl SelectedIndex="{Binding SelectedIndex}" Background="{StaticResource Brush.Surface}">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Margin" Value="{StaticResource Margin.TopSmall}"/>
                            <Setter Property="Padding" Value="{StaticResource Padding.Content}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="FontSize" Value="14"/>
                        </Style>
                    </TabControl.Resources>

                    <TabItem DataContext="{Binding Ead}">
                        <TabItem.Header>
                            <TextBlock Text="EAD" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:EadView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding UpdatedCost}">
                        <TabItem.Header>
                            <TextBlock Text="Updated Cost of Storage" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:UpdatedCostView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding Annualizer}">
                        <TabItem.Header>
                            <TextBlock Text="Cost Annualization" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:AnnualizerView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding WaterDemand}">
                        <TabItem.Header>
                            <TextBlock Text="Water Demand" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:WaterDemandView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding Udv}">
                        <TabItem.Header>
                            <TextBlock Text="Unit Day Value" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:UdvView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding MindMap}">
                        <TabItem.Header>
                            <TextBlock Text="Mind Map" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:MindMapView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                </TabControl>
            </ScrollViewer>
        </Border>

        <Border Grid.Row="2"
                Background="{StaticResource Brush.SurfaceAlt}"
                Padding="{StaticResource Padding.Section}">
            <ContentControl Content="{Binding}">
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="ContentTemplate" Value="{StaticResource ActionsNarrowTemplate}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                         Value="Wide">
                                <Setter Property="ContentTemplate" Value="{StaticResource ActionsWideTemplate}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>
        </Border>
    </Grid>
</Window>
