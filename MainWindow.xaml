<Window x:Class="EconToolbox.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:EconToolbox.Desktop.ViewModels"
        xmlns:views="clr-namespace:EconToolbox.Desktop.Views"
        Title="Economic Toolbox"
        Height="700"
        Width="960"
        MinWidth="640"
        MinHeight="600"
        ResizeMode="CanResize"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True">
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="HeroWideTemplate">
                <Grid Margin="0"
                      HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*" MinWidth="300"/>
                    </Grid.ColumnDefinitions>
                    <Canvas Width="120"
                            Height="80"
                            Margin="{StaticResource Margin.InlineLarge}">
                        <Path Data="M10,70 L30,45 L55,55 L85,20"
                              Stroke="White"
                              StrokeThickness="4"
                              StrokeEndLineCap="Round"
                              StrokeStartLineCap="Round"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="6" Canvas.Top="65"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="26" Canvas.Top="40"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="51" Canvas.Top="50"/>
                        <Ellipse Width="12" Height="12" Fill="White" Canvas.Left="79" Canvas.Top="14"/>
                    </Canvas>
                    <StackPanel Grid.Column="1">
                        <StackPanel Orientation="Horizontal" Margin="{StaticResource Margin.Stack}">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       FontSize="30"
                                       Foreground="White"
                                       Margin="{StaticResource Margin.Inline}"/>
                            <TextBlock Text="Economic Toolbox"
                                       Style="{StaticResource Text.Title}"/>
                        </StackPanel>
                        <TextBlock Style="{StaticResource Text.Body}"
                                   Foreground="White"
                                   Margin="{StaticResource Margin.Stack}">
                            Review each tab to build a complete project narrative. Enter inputs carefully, press Calculate when
                            available, and use Export to capture your work. Context-sensitive tips below explain what each result
                            means and how your assumptions drive it.
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="HeroNarrowTemplate">
                <StackPanel Margin="0"
                            HorizontalAlignment="Stretch">
                    <Canvas Width="100"
                            Height="70"
                            HorizontalAlignment="Center"
                            Margin="{StaticResource Margin.Stack}">
                        <Path Data="M10,60 L25,35 L45,45 L70,15"
                              Stroke="White"
                              StrokeThickness="4"
                              StrokeEndLineCap="Round"
                              StrokeStartLineCap="Round"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="6" Canvas.Top="55"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="24" Canvas.Top="30"/>
                        <Ellipse Width="10" Height="10" Fill="{StaticResource Brush.Accent}" Canvas.Left="44" Canvas.Top="40"/>
                        <Ellipse Width="12" Height="12" Fill="White" Canvas.Left="68" Canvas.Top="10"/>
                    </Canvas>
                    <StackPanel Margin="{StaticResource Margin.Stack}"
                                HorizontalAlignment="Center">
                        <TextBlock Text="Economic Toolbox"
                                   Style="{StaticResource Text.Title}"/>
                    </StackPanel>
                    <TextBlock Style="{StaticResource Text.Body}"
                               Foreground="White"
                               TextAlignment="Center"
                               Margin="{StaticResource Margin.Stack}">
                        Review each tab to build a complete project narrative. Enter inputs carefully, press Calculate when
                        available, and use Export to capture your work. Context-sensitive tips below explain what each result means
                        and how your assumptions drive it.
                    </TextBlock>
                </StackPanel>
            </DataTemplate>

            <DataTemplate x:Key="ActionsWideTemplate">
                <Grid HorizontalAlignment="Right"
                      Grid.IsSharedSizeScope="True">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="ActionButtons"/>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="ActionButtons"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="CalculateButton"
                            Command="{Binding CalculateCommand}"
                            Margin="{StaticResource Margin.Inline}"
                            HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Calculate"/>
                        </StackPanel>
                    </Button>
                    <Button Grid.Column="1"
                            Command="{Binding ExportCommand}"
                            HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Export"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="ActionsNarrowTemplate">
                <StackPanel>
                    <Button Command="{Binding CalculateCommand}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Calculate"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding ExportCommand}">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <TextBlock FontFamily="Segoe MDL2 Assets"
                                       Text=""
                                       Margin="{StaticResource Margin.Inline}"
                                       FontSize="16"/>
                            <TextBlock Text="Export"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </DataTemplate>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Background="{StaticResource Brush.Primary}"
                Padding="{StaticResource Padding.Section}"
                CornerRadius="0,0,12,12">
            <ContentControl Content="{Binding}">
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="ContentTemplate" Value="{StaticResource HeroNarrowTemplate}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                         Value="Wide">
                                <Setter Property="ContentTemplate" Value="{StaticResource HeroWideTemplate}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>
        </Border>

        <Border Grid.Row="1"
                Margin="{StaticResource Margin.Container}"
                Padding="0"
                Background="{StaticResource Brush.SurfaceAlt}"
                CornerRadius="12">
            <ScrollViewer Focusable="False"
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto">
                <TabControl SelectedIndex="{Binding SelectedIndex}" Background="{StaticResource Brush.Surface}">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Margin" Value="{StaticResource Margin.TopSmall}"/>
                            <Setter Property="Padding" Value="{StaticResource Padding.Content}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="FontSize" Value="14"/>
                        </Style>
                    </TabControl.Resources>

                    <TabItem DataContext="{Binding Ead}">
                        <TabItem.Header>
                            <TextBlock Text="EAD" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:EadView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding UpdatedCost}">
                        <TabItem.Header>
                            <TextBlock Text="Updated Cost of Storage" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:UpdatedCostView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding Annualizer}">
                        <TabItem.Header>
                            <TextBlock Text="Cost Annualization" TextAlignment="Center"/>
                        </TabItem.Header>
                        <ScrollViewer Padding="{StaticResource Padding.Card}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" MinWidth="160"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Grid.Resources>
                                    <Style x:Key="AnnualizerLabelStyle" TargetType="TextBlock">
                                        <Setter Property="Grid.Column" Value="0"/>
                                        <Setter Property="Grid.ColumnSpan" Value="1"/>
                                        <Setter Property="Margin" Value="0,16,12,4"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                         Value="Narrow">
                                                <Setter Property="Grid.ColumnSpan" Value="2"/>
                                                <Setter Property="Margin" Value="0,16,0,4"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>

                                    <Style x:Key="AnnualizerInputStyle" TargetType="FrameworkElement">
                                        <Setter Property="Grid.Column" Value="0"/>
                                        <Setter Property="Grid.ColumnSpan" Value="2"/>
                                        <Setter Property="Margin" Value="0,0,0,16"/>
                                        <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                         Value="Wide">
                                                <Setter Property="Grid.Column" Value="1"/>
                                                <Setter Property="Grid.ColumnSpan" Value="1"/>
                                                <Setter Property="Margin" Value="12,0,0,16"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Resources>

                                <Border Grid.Row="0" Grid.ColumnSpan="2"
                                        Background="#E8F4FB"
                                        BorderBrush="{StaticResource Brush.Primary}"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Padding="{StaticResource Padding.Card}"
                                        Margin="{StaticResource Margin.StackLarge}">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="{StaticResource Margin.Stack}">
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="20" Foreground="{StaticResource Brush.SurfaceAlt}" Margin="{StaticResource Margin.Inline}"/>
                                            <TextBlock Text="Cost Annualization Workflow" FontWeight="Bold" FontSize="16" Foreground="{StaticResource Brush.Primary}"/>
                                        </StackPanel>
                                        <TextBlock TextWrapping="Wrap">
                                            1. Document upfront investments, financing assumptions, and the analysis period.
                                            2. Capture the construction cash flow in the IDC schedule and list all future costs in the year they occur.
                                            3. Provide annual O&amp;M and annual benefits so the tool can translate capital outlays into comparable annual metrics.
                                            Use the Calculate button at the bottom of the window whenever you update inputs.
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <TextBlock Grid.Row="1" Text="First Cost" Style="{StaticResource AnnualizerLabelStyle}"/>
                                <TextBox Grid.Row="2" Text="{Binding FirstCost}" ToolTip="Initial project cost.">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="1"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Row="3" Text="Rate (%)" Style="{StaticResource AnnualizerLabelStyle}"/>
                                <TextBox Grid.Row="4" Text="{Binding Rate}" ToolTip="Discount rate in percent.">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="3"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Row="5" Text="Base Year" Style="{StaticResource AnnualizerLabelStyle}"/>
                                <TextBox Grid.Row="6" Text="{Binding BaseYear}">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Row="7" Text="Analysis Period" Style="{StaticResource AnnualizerLabelStyle}"/>
                                <TextBox Grid.Row="8" Text="{Binding AnalysisPeriod}" ToolTip="Number of periods for capital recovery.">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="7"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Row="9" Text="Annual O&amp;M" Style="{StaticResource AnnualizerLabelStyle}"/>
                                <TextBox Grid.Row="10" Text="{Binding AnnualOm}" ToolTip="Annual operations and maintenance cost.">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="9"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Row="11" Text="Annual Benefits" Style="{StaticResource AnnualizerLabelStyle}"/>
                                <TextBox Grid.Row="12" Text="{Binding AnnualBenefits}" ToolTip="Expected annual benefits.">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="11"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Row="13" Text="Construction Months" Style="{StaticResource AnnualizerLabelStyle}"/>
                                <TextBox Grid.Row="14" Text="{Binding ConstructionMonths}">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="13"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <TextBlock Grid.Row="15" Text="IDC Schedule">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock" BasedOn="{StaticResource AnnualizerLabelStyle}">
                                            <Setter Property="Margin" Value="0,24,12,4"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Narrow">
                                                    <Setter Property="Margin" Value="0,24,0,4"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Grid Grid.Row="16">
                                    <Grid.Style>
                                        <Style TargetType="Grid" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="15"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Grid.Style>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Border Background="White" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="6" Padding="6">
                                        <DataGrid ItemsSource="{Binding IdcEntries}" AutoGenerateColumns="False" Margin="0" HeadersVisibility="All">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Cost" Binding="{Binding Cost}"/>
                                                <DataGridTextColumn Header="Month" Binding="{Binding Year}"/>
                                                <DataGridComboBoxColumn Header="Timing" SelectedItemBinding="{Binding Timing}">
                                                    <DataGridComboBoxColumn.ItemsSource>
                                                        <x:Array Type="sys:String" xmlns:sys="clr-namespace:System;assembly=mscorlib">
                                                            <sys:String>beginning</sys:String>
                                                            <sys:String>midpoint</sys:String>
                                                            <sys:String>end</sys:String>
                                                        </x:Array>
                                                    </DataGridComboBoxColumn.ItemsSource>
                                                </DataGridComboBoxColumn>
                                                <DataGridTextColumn Header="PV Factor" Binding="{Binding PvFactor}" IsReadOnly="True"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </Border>
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                                        <Button Command="{Binding ResetIdcCommand}" MinWidth="160" ToolTip="Clear all IDC schedule entries">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                                <TextBlock Text="Reset IDC Inputs"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <TextBlock Grid.Row="17" Text="Future Costs">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock" BasedOn="{StaticResource AnnualizerLabelStyle}">
                                            <Setter Property="Margin" Value="0,24,12,4"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Narrow">
                                                    <Setter Property="Margin" Value="0,24,0,4"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Grid Grid.Row="18">
                                    <Grid.Style>
                                        <Style TargetType="Grid" BasedOn="{StaticResource AnnualizerInputStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Grid.Row" Value="17"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Grid.Style>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Border Background="White" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="6" Padding="6">
                                        <DataGrid ItemsSource="{Binding FutureCosts}" AutoGenerateColumns="False" Margin="0">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Cost" Binding="{Binding Cost}"/>
                                                <DataGridTextColumn Header="Year" Binding="{Binding Year}"/>
                                                <DataGridComboBoxColumn Header="Timing" SelectedItemBinding="{Binding Timing}">
                                                    <DataGridComboBoxColumn.ItemsSource>
                                                        <x:Array Type="sys:String" xmlns:sys="clr-namespace:System;assembly=mscorlib">
                                                            <sys:String>beginning</sys:String>
                                                            <sys:String>midpoint</sys:String>
                                                            <sys:String>end</sys:String>
                                                        </x:Array>
                                                    </DataGridComboBoxColumn.ItemsSource>
                                                </DataGridComboBoxColumn>
                                                <DataGridTextColumn Header="PV Factor" Binding="{Binding PvFactor}" IsReadOnly="True"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </Border>
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                                        <Button Command="{Binding ResetFutureCostsCommand}" MinWidth="160" ToolTip="Clear all future cost entries">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Margin="{StaticResource Margin.Inline}"/>
                                                <TextBlock Text="Reset Future Costs"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <UniformGrid Grid.Row="19" Grid.ColumnSpan="2" Columns="1" Margin="{StaticResource Margin.TopLarge}">
                                    <UniformGrid.Style>
                                        <Style TargetType="UniformGrid">
                                            <Setter Property="Columns" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabItem}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                                             Value="Wide">
                                                    <Setter Property="Columns" Value="2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </UniformGrid.Style>
                                    <Border Background="White" CornerRadius="6" Padding="{StaticResource Padding.Content}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" Margin="{StaticResource Margin.Stack}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="18" Foreground="{StaticResource Brush.Primary}" Margin="{StaticResource Margin.Inline}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" FontWeight="Bold" Text="{Binding Idc, StringFormat=IDC: {0:C2}}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" TextWrapping="Wrap" Margin="{StaticResource Margin.InlineMedium}" Foreground="{StaticResource Brush.TextSecondary}">
                                                Interest during construction accumulates from the IDC schedule using your month, timing, and rate inputs. Higher rates or longer construction windows increase this value.
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                    <Border Background="White" CornerRadius="6" Padding="{StaticResource Padding.Content}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" Margin="{StaticResource Margin.Stack}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="18" Foreground="{StaticResource Brush.Primary}" Margin="{StaticResource Margin.Inline}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" FontWeight="Bold" Text="{Binding TotalInvestment, StringFormat=Total Investment: {0:C2}}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" TextWrapping="Wrap" Margin="{StaticResource Margin.InlineMedium}" Foreground="{StaticResource Brush.TextSecondary}">
                                                Total investment combines First Cost, IDC, and the present value of Future Costs. Adding more future expenses or higher IDC immediately raises this figure.
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                    <Border Background="White" CornerRadius="6" Padding="{StaticResource Padding.Content}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" Margin="{StaticResource Margin.Stack}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="18" Foreground="{StaticResource Brush.Primary}" Margin="{StaticResource Margin.Inline}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" FontWeight="Bold" Text="{Binding Crf, StringFormat=CRF: {0:F4}}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" TextWrapping="Wrap" Margin="{StaticResource Margin.InlineMedium}" Foreground="{StaticResource Brush.TextSecondary}">
                                                The capital recovery factor converts present investment into an equivalent annual cost. It is entirely driven by your discount rate and analysis period selections.
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                    <Border Background="White" CornerRadius="6" Padding="{StaticResource Padding.Content}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" Margin="{StaticResource Margin.Stack}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="18" Foreground="{StaticResource Brush.Primary}" Margin="{StaticResource Margin.Inline}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" FontWeight="Bold" Text="{Binding AnnualCost, StringFormat=Annual Cost: {0:C2}}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" TextWrapping="Wrap" Margin="{StaticResource Margin.InlineMedium}" Foreground="{StaticResource Brush.TextSecondary}">
                                                Annual cost reflects how the total investment and your O&amp;M inputs translate into yearly expenses. Increasing either component will raise this annualized value.
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                    <Border Background="White" CornerRadius="6" Padding="{StaticResource Padding.Content}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="18" Foreground="{StaticResource Brush.Primary}" Margin="{StaticResource Margin.Inline}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" FontWeight="Bold" Text="{Binding Bcr, StringFormat=BCR: {0:F2}}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" TextWrapping="Wrap" Margin="{StaticResource Margin.InlineMedium}" Foreground="{StaticResource Brush.TextSecondary}">
                                                Benefit-cost ratio compares annual benefits against annual costs. Greater benefits or lower annual costs will push the BCR upward, signaling a stronger economic case.
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                </UniformGrid>
                            </Grid>
                        </ScrollViewer>
                    </TabItem>
                    <TabItem DataContext="{Binding WaterDemand}">
                        <TabItem.Header>
                            <TextBlock Text="Water Demand" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:WaterDemandView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                    <TabItem DataContext="{Binding Udv}">
                        <TabItem.Header>
                            <TextBlock Text="Unit Day Value" TextAlignment="Center"/>
                        </TabItem.Header>
                        <views:UdvView Margin="{StaticResource Margin.Container}"/>
                    </TabItem>
                </TabControl>
            </ScrollViewer>
        </Border>

        <Border Grid.Row="2"
                Background="{StaticResource Brush.SurfaceAlt}"
                Padding="{StaticResource Padding.Section}">
            <ContentControl Content="{Binding}">
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Setter Property="ContentTemplate" Value="{StaticResource ActionsNarrowTemplate}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource WidthToLayoutModeConverter}}"
                                         Value="Wide">
                                <Setter Property="ContentTemplate" Value="{StaticResource ActionsWideTemplate}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>
        </Border>
    </Grid>
</Window>
